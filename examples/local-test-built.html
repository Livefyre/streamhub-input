<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/dist/streamhub-input.min.css">
    <style>
    #comment-editor {
        width:500px;
        position: absolute;
        top: 12px;
        right: 12px;
    }

    legend {
        text-decoration: underline;
        text-transform: uppercase;
    }

    label {
        font-style: italic;
        text-transform: capitalize;
        padding-left: 2em;
    }

    label:after {
        content: ":";
    }

    button {
        margin-right: 2em;
    }

    </style>
</head>
    <body class="lf">
        <legend>authentication</legend>
        <button id="auth-button" class="auth-button">Log in</button>
        <legend>collection</legend>
        <label>network</label>
        <input type="text" id="network" value="fyre" />
        <br>
        <label>site ID</label>
        <input type="text" id="siteId" value="286470" />
        <br>
        <label>article ID</label>
        <input type="text" id="articleId" value="input-1" />

        <section id="upper-controls">
            <button id="top-upload">Post Your Photo <i class="fycon-composer-photo"></i></button>
            <button id="top-comment">Post Your Comment</button>
        </section>

        <div id="wall"></div>

        <section id="lower-controls">
            <button id="btm-upload">Post Your Photo <i class="fycon-composer-photo"></i></button>
            <button id="btm-comment">Post Your Comment</button>
        </section>

        <div id="comment-editor"></div>

        <script src="http://cdn.livefyre.com/libs/livefyre-auth/0.1.0/livefyre-auth.min.js" type="text/javascript"></script>l
        <script src="http://cdn.livefyre.com/libs/sdk/v2.9.1/streamhub-sdk.min.js"></script>
        <script src="http://cdn.livefyre.com/libs/apps/Livefyre/streamhub-wall/v2.3.0-build.184/streamhub-wall.min.js"></script>
        <script src='/dist/streamhub-input.min.js' type="text/javascript"></script>

        <script>
        var $ = Livefyre.require('streamhub-sdk/jquery');
        var Collection = Livefyre.require('streamhub-sdk/collection');
        var Wall = Livefyre.require('streamhub-wall');
        var StreamHubInput = Livefyre.require('streamhub-input');
        var collection;

        var ContentEditor = StreamHubInput.ContentEditor;
        var UploadButton = StreamHubInput.UploadButton;
        var CommentButton = StreamHubInput.ContentEditorButton;

        Livefyre.auth.delegate(Livefyre.auth.createDelegate('http://www.fyre'));

        wall = new Wall({
            initial: 5,
            showMore: 4,
            el: document.getElementById("wall")
        });


        embCom = new ContentEditor({
            el: document.getElementById("comment-editor"),
            mediaEnabled: true
        });
        embCom.render();

        topUp = new UploadButton({
            el: document.getElementById("top-upload")
        });

        topCom = new CommentButton({
            el: document.getElementById("top-comment"),
            mediaEnabled: true
        });

        btmUp = new UploadButton({
            el: document.getElementById("btm-upload")
        });

        btmCom = new CommentButton({
            el: document.getElementById("btm-comment")
        });

        inputs = [embCom, topUp, topCom, btmUp, btmCom];


        $(function () {
            // createAuthButton(auth, document.getElementById('auth-button'));
            onPageLoad();
        });

        function onPageLoad() {
            var token = $('#lftoken').val(),
                network = $('#network').val(),
                site = $('#siteId').val(),
                article = $('#articleId').val();

            token && Auth.setToken(token);

            if (!network || !site || !article) {
                return;
            }

            opts = {
                network: network,
                siteId: site,
                articleId: article,
                autoCreate: true
            }

            opts.collectionMeta = {
                articleId: opts.articleId,
                title: 'New input demo collection for article #' + opts.articleId + ' site#' + opts.siteId,
                url: 'http://fyre.' + opts.articleId,
                checksum: String(Math.random())
            }

            if (collection) {
                destroy();
            }

            build(opts);
        }

        function build(opts) {
            collection = new Collection(opts);
            collection.pipe(wall);
            archive = collection.createArchive();
            archive.pipe(wall.more);

            // embCom.setDestination(collection);
            inputs.forEach(function (o) {
                o && o.pipe(collection);
            });
        }

        function destroy() {
            inputs.forEach(function (o) {
                o && o.unpipe(collection);
            });

            collection.unpipe(wall);
            archive.unpipe(wall);
            //TODO (joao) Destroy collection?
            archive = collection = null;
        }
        </script>
    </body>
</html>
